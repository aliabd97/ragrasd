# ๐ AI Chunking - ุฏููู ุงูุจุฏุก ุงูุณุฑูุน

## ูุง ูู AI Chunkingุ

ูุธุงู ุชูุณูู ุฐูู ูุณุชุฎุฏู Claude API ููุนุงูุฌุฉ ุงููุชุจ ุงูุชุฑุงุซูุฉ:
- ๐ค ุงุณุชุฎุฑุงุฌ ุชููุงุฆู ูููุตุงุฏุฑ ูู ุงููุตูุต
- ๐ ุชูุณูู ุฐูู ุฅูู ุฃูุณุงู ูููุฑุงุช
- โ ุงูุญูุงุธ ุนูู 100% ูู ุงููุตุงุฏุฑ
- ๐ฐ ุชูููุฉ ููุฎูุถุฉ (~$2.50 ููุชุงุจ ูู 4 ุฃุฌุฒุงุก)

---

## โก ุงูุจุฏุก ูู 5 ุฏูุงุฆู

### ุงูุฎุทูุฉ 1: ุงูุชุซุจูุช
```bash
pip install anthropic python-dotenv
```

### ุงูุฎุทูุฉ 2: ุฅุนุฏุงุฏ API Key
```bash
# ุฅูุดุงุก .env
echo "ANTHROPIC_API_KEY=sk-ant-your-key-here" > .env
```

**ุงุญุตู ุนูู API Key ูู:** https://console.anthropic.com/

### ุงูุฎุทูุฉ 3: ุฅุถุงูุฉ ุงููุตูุต
```bash
# ุถุน ูููุงุช ุงููุตูุต ูู data/raw/
mkdir -p data/raw
# ุงูุณุฎ ูููุงุชู ููุง
```

### ุงูุฎุทูุฉ 4: ุชุญุฏูุซ ุงูููุฏ

ุงูุชุญ `build/step2_ai_chunking.py` ูุงุฐูุจ ุฅูู ุงูุณุทุฑ ~370:

```python
# ุงุณุชุจุฏู ูุฐุง:
volumes = {
    # 1: 'data/raw/ุงูุดุงูู_ูู_ุงูุฅูุงูุฉ_ุฌ1.txt',
}

# ุจูุฐุง:
volumes = {
    1: 'data/raw/your_book_v1.txt',
    2: 'data/raw/your_book_v2.txt',
}
```

### ุงูุฎุทูุฉ 5: ุงูุชุดุบูู
```bash
python build/step2_ai_chunking.py
```

**ุงูุชุธุฑ...** (10-30 ุฏูููุฉ ุญุณุจ ุญุฌู ุงููุชุงุจ)

### ุงูุฎุทูุฉ 6: ุงูุชุญูู
```bash
# ุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช
python tests/test_chunking.py
```

---

## ๐ ูุงุฐุง ูุญุฏุซุ

### ุงููุฑุญูุฉ 1: ุงุณุชุฎุฑุงุฌ ุงููุตุงุฏุฑ (5-10 ุฏูุงุฆู)
```
๐ Extracting citations from volume 1...
   ๐ค Calling Claude API...
   Tokens: 45231 in, 3421 out
   Cost: $0.19
โ Extracted 1117 citations
```

### ุงููุฑุญูุฉ 2: ุฅูุดุงุก ุงูุฃูุณุงู (5-10 ุฏูุงุฆู)
```
๐ Creating sections for volume 1...
   ๐ค Calling Claude API...
โ Created 80 sections
```

### ุงููุฑุญูุฉ 3: ุฅูุดุงุก ุงูููุฑุงุช (10-15 ุฏูููุฉ)
```
๐ Creating paragraphs
Processing sections: 100%|โโโโโโโโ| 80/80
โ Created 700 paragraphs
```

---

## ๐ ุงููุชุงุฆุฌ

ุจุนุฏ ุงูุงูุชูุงุกุ ุณุชุฌุฏ:

```
data/processed/
โโโ citations_extracted/
โ   โโโ citations_ุฌ1.json        # 1๏ธโฃ ุงููุตุงุฏุฑ ุงููุณุชุฎุฑุฌุฉ
โโโ documents.json                # 2๏ธโฃ ูุนูููุงุช ุงููุชุจ
โโโ sections.json                 # 3๏ธโฃ ุงูุฃูุณุงู
โโโ paragraphs.json               # 4๏ธโฃ ุงูููุฑุงุช
โโโ chunking_stats.json           # ๐ ุงูุฅุญุตุงุฆูุงุช
```

### ูุซุงู ุนูู citations.json
```json
{
  "citations": [
    {
      "citation_id": "cite_v1_001",
      "appearance_in_text": "(1)",
      "source": {
        "book_name": "ุชุงุฑูุฎ ุงูุทุจุฑู",
        "full_reference": "ุชุงุฑูุฎ ุงูุทุจุฑูุ ุฌ3ุ ุต45"
      },
      "context": "ููุง ุฐูุฑ ูู ุงููุตุฏุฑ (1) ุฃู..."
    }
  ]
}
```

### ูุซุงู ุนูู paragraphs.json
```json
{
  "para_id": "shafi_v1_s001_p001",
  "text": "ุงููุต ุงููุงูู ููููุฑุฉ...",
  "citations": [
    {
      "citation_id": "cite_v1_001",
      "appearance": "(1)",
      "source": {
        "book": "ุชุงุฑูุฎ ุงูุทุจุฑู",
        "reference": "ุชุงุฑูุฎ ุงูุทุจุฑูุ ุฌ3ุ ุต45"
      }
    }
  ],
  "parent_section": "shafi_v1_s001"
}
```

---

## ๐ฐ ุงูุชูููุฉ

**ูุซุงู ูุนูู (ูุชุงุจ ูู 4 ุฃุฌุฒุงุก):**
- ุงูุฌุฒุก 1: $0.58
- ุงูุฌุฒุก 2: $0.62
- ุงูุฌุฒุก 3: $0.55
- ุงูุฌุฒุก 4: $0.72
- **ุงูุฅุฌูุงูู: $2.47**

**ุงูุนูุงูู ุงููุคุซุฑุฉ:**
- ุทูู ุงููุต (ุนุฏุฏ ุงููููุงุช)
- ุนุฏุฏ ุงููุตุงุฏุฑ
- ุชุนููุฏ ุงูุจููุฉ

---

## โ ุญู ุงููุดุงูู ุงูุดุงุฆุนุฉ

### 1. `Missing API key`
```bash
# ุชุฃูุฏ ูู ูุฌูุฏ .env
cat .env

# ูุฌุจ ุฃู ูุญุชูู:
ANTHROPIC_API_KEY=sk-ant-...
```

### 2. `No module named 'anthropic'`
```bash
pip install anthropic
```

### 3. `File not found: data/raw/...`
```bash
# ุชุฃูุฏ ูู ูุฌูุฏ ุงููููุงุช
ls data/raw/

# ุฅุฐุง ูู ุชูุฌุฏุ ุฃูุดุฆ ุงููุฌูุฏ ูุงูุณุฎ ุงููููุงุช
mkdir -p data/raw
cp /path/to/your/files/*.txt data/raw/
```

### 4. `Citations mismatch warning`

**ูุฐุง ุชุญุฐูุฑ ูููุณ ุฎุทุฃ.** ูุนูู ุฃู Claude ุฑุจูุง ูููุช ุจุนุถ ุงููุตุงุฏุฑ.

**ุงูุญู:**
- ุฑุงุฌุน ุงููุชุงุฆุฌ ูุฏููุงู
- ุฃุนุฏ ุชุดุบูู ุงููุฑุญูุฉ ุงููุนููุฉ
- ุฃู ูุจู ุงููุชูุฌุฉ ุฅุฐุง ูุงู ุงููุฑู ุตุบูุฑ (<5%)

---

## ๐งช ุงูุชุญูู ูู ุงููุชุงุฆุฌ

```bash
# ุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช
python tests/test_chunking.py
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
```
โ PASS: All Citations Preserved
โ PASS: Chunks Have Sources
โ PASS: No Broken Citations
โ PASS: Hierarchy Integrity
โ PASS: JSON Structure

Total: 5/5 tests passed
๐ All tests passed!
```

---

## ๐ ุงููููุงุช ุงููููุฉ

| ุงูููู | ุงููุตู |
|-------|-------|
| `build/step2_ai_chunking.py` | ุงูุณูุฑูุจุช ุงูุฑุฆูุณู |
| `build/prompts/*.txt` | ููุงูุจ ุงูู prompts |
| `utils/validators.py` | ุฃุฏูุงุช ุงูุชุญูู |
| `tests/test_chunking.py` | ุงูุงุฎุชุจุงุฑุงุช |
| `config.yaml` | ุงูุฅุนุฏุงุฏุงุช |
| `.env` | API Keys |

---

## โ๏ธ ุงูุชุฎุตูุต

### ุชุบููุฑ ุงููููุฐุฌ
```yaml
# ูู config.yaml
chunking:
  model: "claude-sonnet-4-20250514"  # ุงููููุฐุฌ ุงูุฃุญุฏุซ
  # ุฃู
  model: "claude-3-5-sonnet-20241022"  # ุฃุฑุฎุต
```

### ุชุบููุฑ max_tokens
```yaml
chunking:
  max_tokens: 16000  # ุงูุงูุชุฑุงุถู
  # ูููู ุฅุฐุง ูุงู ุจุทูุฆุงู:
  max_tokens: 8000
```

### ุชุนุฏูู Prompts

ููููู ุชุญุณูู ุงููุชุงุฆุฌ ุจุชุนุฏูู ุงูู prompts ูู:
- `build/prompts/extract_citations.txt`
- `build/prompts/create_sections.txt`
- `build/prompts/create_paragraphs.txt`

---

## ๐ฏ ุงูุฎุทูุฉ ุงูุชุงููุฉ

ุจุนุฏ ุฅุชูุงู AI Chunking:

โ **ูุฏูู ุงูุขู:**
- ุจูุงูุงุช ููุธูุฉ ูุฑููุงู โ
- ูุตุงุฏุฑ ูุฑุจูุทุฉ 100% โ
- ุฌุงูุฒุฉ ูููุนุงูุฌุฉ โ

โญ๏ธ **ุงูุฎุทูุฉ ุงูุชุงููุฉ:**
```bash
# Step 3: Embeddings & ChromaDB
python build/step3_embeddings_E5.py
```

---

## ๐ ุงูุชูุซูู ุงููุงูู

ูููุฒูุฏ ูู ุงูุชูุงุตูู:
- `docs/STEP2_AI_CHUNKING_GUIDE.md` - ุงูุฏููู ุงููุงูู
- `README.md` - ูุธุฑุฉ ุนุงูุฉ ุนูู ุงููุดุฑูุน

---

## ๐ก ูุตุงุฆุญ ูููุฉ

1. **ุงุจุฏุฃ ุจุฌุฒุก ูุงุญุฏ** ููุชุฌุฑุจุฉ ูุจู ูุนุงูุฌุฉ ูู ุงูุฃุฌุฒุงุก
2. **ุงุญูุธ ูุณุฎุฉ ุงุญุชูุงุทูุฉ** ูู ุงููุชุงุฆุฌ
3. **ุฑุงุฌุน ุงูุนููุงุช ูุฏููุงู** ููุชุฃูุฏ ูู ุงูุฌูุฏุฉ
4. **ุงุณุชุฎุฏู ุงูุงุฎุชุจุงุฑุงุช** ุจุนุฏ ูู ุชุดุบูู

---

**ุฌุงูุฒ ููุจุฏุกุ** ๐

```bash
# 1. ุงูุชุซุจูุช
pip install anthropic python-dotenv

# 2. ุฅุนุฏุงุฏ API Key
echo "ANTHROPIC_API_KEY=sk-ant-..." > .env

# 3. ุงูุชุดุบูู
python build/step2_ai_chunking.py
```

**ุญุธุงู ููููุงู!** ๐
